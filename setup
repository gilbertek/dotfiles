#!/usr/bin/env bash

# Install dotfiles symlinks.
set -e

REPO_URL="https://github.com/gilbertek/dotfiles"
REPO_NAME="dotfiles"

msg() {
    printf '%b\n' "$1" >&2
}

success() {
    if [ "$ret" -eq '0' ]; then
        msg "\\033[32m[âœ”]\\033[0m ${1}${2}"
    fi
}

warning() {
    msg "\033[33mWarning:\033[0m ${1}${2}"
}

bkp() {
    if [ -e "$1" ]; then
        rm -rf "$2"
        mv "$1" "$2"
    fi
}

# Check if the repository already exists
if [[ -d "${REPO_NAME}" ]]; then
    echo "Repository ${REPO_NAME}already exists. Skipping clone..."
else
    git clone "${REPO_URL}"
fi

# Check if the clone was successful
if [[ $? -eq 0 ]]; then

    echo "Removing old configs"
    rm -rf ~/.config/nvim
    # rm -rf ~/.config/ghostty
    # rm -rf ~/.config/starship.toml
    rm -rf ~/.local/share/nvim
    rm -rf ~/.cache/nvim
    # Change directory into $HOME/dotfiles
    cd "${HOME}"/dotfiles

    # Install all other packages
    ./scripts/system/removal.sh
    ./scripts/system/install-extras.sh
    ./scripts/system/install-pgsql.sh

    # Use stow to symlink user configs
    stow nvim
    # stow starship
else
    echo "Failed to clone the repository: ${REPO_NAME}"
fi

success "Dotfiles have been configured! ðŸ¤˜"
